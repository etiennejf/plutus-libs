<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cooked.Tx.Constraints</span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Cooked.Tx.Constraints.Type.html"><span class="hs-identifier">Cooked.Tx.Constraints.Type</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-6"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Cooked.Tx.Constraints.Pretty.html"><span class="hs-identifier">Cooked.Tx.Constraints.Pretty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Cooked.Tx.Constraints.html#LedgerConstraint"><span class="hs-identifier">LedgerConstraint</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Cooked.Tx.Constraints.html#extractDatumStr"><span class="hs-identifier">extractDatumStr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Cooked.Tx.Constraints.html#signedByWallets"><span class="hs-identifier">signedByWallets</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Cooked.Tx.Constraints.html#toLedgerConstraint"><span class="hs-identifier">toLedgerConstraint</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Cooked.Tx.Constraints.html#orderTxOutputs"><span class="hs-identifier">orderTxOutputs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">where</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.MockChain.Wallet.html"><span class="hs-identifier">Cooked.MockChain.Wallet</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.Tx.Constraints.Pretty.html"><span class="hs-identifier">Cooked.Tx.Constraints.Pretty</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.Tx.Constraints.Type.html"><span class="hs-identifier">Cooked.Tx.Constraints.Type</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Function</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">on</span></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Ledger</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Pl</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">singleton</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unspentOutputs</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Constraints</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Pl</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Constraints.TxConstraints</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Pl</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Credential</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Pl</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Scripts</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Pl</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Typed.Scripts</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Pl</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DatumType</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">RedeemerType</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">validatorScript</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.Script.Utils.V1.Scripts</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Pl</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">PlutusTx</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Pl</span></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-comment">-- * Converting 'Constraint's to 'Pl.ScriptLookups', 'Pl.TxConstraints'</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">type</span><span> </span><span id="LedgerConstraint"><span class="annot"><a href="Cooked.Tx.Constraints.html#LedgerConstraint"><span class="hs-identifier hs-var">LedgerConstraint</span></a></span></span><span> </span><span id="local-6989586621679560595"><span class="annot"><a href="#local-6989586621679560595"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pl.ScriptLookups</span></span><span> </span><span class="annot"><a href="#local-6989586621679560595"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pl.TxConstraints</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pl.RedeemerType</span></span><span> </span><span class="annot"><a href="#local-6989586621679560595"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pl.DatumType</span></span><span> </span><span class="annot"><a href="#local-6989586621679560595"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-comment">-- | Convenience class for common operations on what can be converted to</span><span>
</span><span id="line-36"></span><span class="hs-comment">-- 'LedgerConstraint' (in other words native Plutus `Pl.TxConstraints`). This</span><span>
</span><span id="line-37"></span><span class="hs-comment">-- covers output constraints 'OutConstraint', miscelaneous constraints</span><span>
</span><span id="line-38"></span><span class="hs-comment">-- 'MiscConstraint', and combinations of both within 'Constraints'.</span><span>
</span><span id="line-39"></span><span class="hs-comment">--</span><span>
</span><span id="line-40"></span><span class="hs-comment">-- As a user, you should not have to deal with or worry about this class and</span><span>
</span><span id="line-41"></span><span class="hs-comment">-- stick with the 'ConstraintsSpec' instances to specify constraints in</span><span>
</span><span id="line-42"></span><span class="hs-comment">-- transaction skeletons 'TxSkel'.</span><span>
</span><span id="line-43"></span><span class="hs-keyword">class</span><span> </span><span id="ToLedgerConstraint"><span class="annot"><a href="Cooked.Tx.Constraints.html#ToLedgerConstraint"><span class="hs-identifier hs-var">ToLedgerConstraint</span></a></span></span><span> </span><span id="local-6989586621679560713"><span class="annot"><a href="#local-6989586621679560713"><span class="hs-identifier hs-type">constraint</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-comment">-- | Map from datum hashes to string representation of all the datums carried.</span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-comment">-- We use this in order to display data to the use when testing. Its often</span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-comment">-- easier to read the original datatype that was placed into a UTxO</span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-comment">-- instead of its respective @toBuilinData@ image.</span><span>
</span><span id="line-48"></span><span>  </span><span id="extractDatumStr"><span class="annot"><a href="Cooked.Tx.Constraints.html#extractDatumStr"><span class="hs-identifier hs-type">extractDatumStr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679560713"><span class="hs-identifier hs-type">constraint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pl.DatumHash</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span>  </span><span class="hs-comment">-- | Converts our constraint into a 'LedgerConstraint',</span><span>
</span><span id="line-51"></span><span>  </span><span class="hs-comment">--  which later can be used to generate a transaction. The universally</span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-comment">--  quantified type-variable is there on purpose, to enable us to</span><span>
</span><span id="line-53"></span><span>  </span><span class="hs-comment">--  easily spend from multiple scripts at the same time.</span><span>
</span><span id="line-54"></span><span>  </span><span id="local-6989586621679560716"><span id="toLedgerConstraint"><span class="annot"><a href="Cooked.Tx.Constraints.html#toLedgerConstraint"><span class="hs-identifier hs-type">toLedgerConstraint</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679560713"><span class="hs-identifier hs-type">constraint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.Tx.Constraints.html#LedgerConstraint"><span class="hs-identifier hs-type">LedgerConstraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679560716"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cooked.Tx.Constraints.html#ToLedgerConstraint"><span class="hs-identifier hs-type">ToLedgerConstraint</span></a></span><span> </span><span class="annot"><a href="Cooked.Tx.Constraints.Type.html#MiscConstraint"><span class="hs-identifier hs-type">MiscConstraint</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-57"></span><span>  </span><span id="local-6989586621679560591"><span class="annot"><span class="annottext">extractDatumStr :: MiscConstraint -&gt; Map DatumHash String
</span><a href="#local-6989586621679560591"><span class="hs-identifier hs-var hs-var hs-var hs-var">extractDatumStr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tx.Constraints.Type.html#SpendsScript"><span class="hs-identifier hs-type">SpendsScript</span></a></span><span> </span><span class="annot"><span class="annottext">TypedValidator a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">RedeemerType a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pl.ScriptChainIndexTxOut</span></span><span> </span><span class="annot"><span class="annottext">Address
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Either ValidatorHash Validator
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679560588"><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679560588"><span class="hs-identifier hs-var">datum</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><span class="annottext">DatumHash -&gt; String -&gt; Map DatumHash String
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Datum -&gt; DatumHash
</span><span class="hs-identifier hs-var">Pl.datumHash</span></span><span> </span><span class="annot"><span class="annottext">(Datum -&gt; DatumHash)
-&gt; (BuiltinData -&gt; Datum) -&gt; BuiltinData -&gt; DatumHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BuiltinData -&gt; Datum
</span><span class="hs-identifier hs-var">Pl.Datum</span></span><span> </span><span class="annot"><span class="annottext">(BuiltinData -&gt; DatumHash) -&gt; BuiltinData -&gt; DatumHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Datum -&gt; BuiltinData
forall a. ToData a =&gt; a -&gt; BuiltinData
</span><span class="hs-identifier hs-var">Pl.toBuiltinData</span></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679560588"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Datum -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679560588"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>  </span><span class="annot"><a href="Cooked.Tx.Constraints.html#extractDatumStr"><span class="hs-identifier hs-var">extractDatumStr</span></a></span><span> </span><span class="annot"><span class="annottext">MiscConstraint
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map DatumHash String
forall k a. Map k a
</span><span class="hs-identifier hs-var">M.empty</span></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span>  </span><span id="local-6989586621679560580"><span class="annot"><span class="annottext">toLedgerConstraint :: MiscConstraint -&gt; LedgerConstraint a
</span><a href="#local-6989586621679560580"><span class="hs-identifier hs-var hs-var hs-var hs-var">toLedgerConstraint</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tx.Constraints.Type.html#SpendsScript"><span class="hs-identifier hs-type">SpendsScript</span></a></span><span> </span><span id="local-6989586621679560579"><span class="annot"><span class="annottext">TypedValidator a
</span><a href="#local-6989586621679560579"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679560578"><span class="annot"><span class="annottext">RedeemerType a
</span><a href="#local-6989586621679560578"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679560577"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679560577"><span class="hs-identifier hs-var">oref</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679560576"><span class="annot"><span class="annottext">ChainIndexTxOut
</span><a href="#local-6989586621679560576"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679560575"><span class="hs-identifier hs-var">lkups</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxConstraints (RedeemerType a) (DatumType a)
</span><a href="#local-6989586621679560574"><span class="hs-identifier hs-var">constr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-63"></span><span>      </span><span id="local-6989586621679560575"><span class="annot"><span class="annottext">lkups :: ScriptLookups a
</span><a href="#local-6989586621679560575"><span class="hs-identifier hs-var hs-var">lkups</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-64"></span><span>        </span><span class="annot"><span class="annottext">Validator -&gt; ScriptLookups a
forall a. Validator -&gt; ScriptLookups a
</span><span class="hs-identifier hs-var">Pl.otherScript</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypedValidator a -&gt; Validator
forall a. TypedValidator a -&gt; Validator
</span><span class="hs-identifier hs-var">Pl.validatorScript</span></span><span> </span><span class="annot"><span class="annottext">TypedValidator a
</span><a href="#local-6989586621679560579"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>          </span><span class="annot"><span class="annottext">ScriptLookups a -&gt; ScriptLookups a -&gt; ScriptLookups a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef ChainIndexTxOut -&gt; ScriptLookups a
forall a. Map TxOutRef ChainIndexTxOut -&gt; ScriptLookups a
</span><span class="hs-identifier hs-var">Pl.unspentOutputs</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef -&gt; ChainIndexTxOut -&gt; Map TxOutRef ChainIndexTxOut
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679560577"><span class="hs-identifier hs-var">oref</span></a></span><span> </span><span class="annot"><span class="annottext">ChainIndexTxOut
</span><a href="#local-6989586621679560576"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>      </span><span id="local-6989586621679560574"><span class="annot"><span class="annottext">constr :: TxConstraints (RedeemerType a) (DatumType a)
</span><a href="#local-6989586621679560574"><span class="hs-identifier hs-var hs-var">constr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxOutRef
-&gt; Redeemer -&gt; TxConstraints (RedeemerType a) (DatumType a)
forall i o. TxOutRef -&gt; Redeemer -&gt; TxConstraints i o
</span><span class="hs-identifier hs-var">Pl.mustSpendScriptOutput</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679560577"><span class="hs-identifier hs-var">oref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinData -&gt; Redeemer
</span><span class="hs-identifier hs-var">Pl.Redeemer</span></span><span> </span><span class="annot"><span class="annottext">(BuiltinData -&gt; Redeemer) -&gt; BuiltinData -&gt; Redeemer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RedeemerType a -&gt; BuiltinData
forall a. ToData a =&gt; a -&gt; BuiltinData
</span><span class="hs-identifier hs-var">Pl.toBuiltinData</span></span><span> </span><span class="annot"><span class="annottext">RedeemerType a
</span><a href="#local-6989586621679560578"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>  </span><span class="annot"><a href="Cooked.Tx.Constraints.html#toLedgerConstraint"><span class="hs-identifier hs-var">toLedgerConstraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tx.Constraints.Type.html#SpendsPK"><span class="hs-identifier hs-type">SpendsPK</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679560568"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679560568"><span class="hs-identifier hs-var">oref</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679560567"><span class="annot"><span class="annottext">ChainIndexTxOut
</span><a href="#local-6989586621679560567"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679560566"><span class="hs-identifier hs-var">lkups</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxConstraints (RedeemerType a) (DatumType a)
</span><a href="#local-6989586621679560565"><span class="hs-identifier hs-var">constr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-69"></span><span>      </span><span id="local-6989586621679560566"><span class="annot"><span class="annottext">lkups :: ScriptLookups a
</span><a href="#local-6989586621679560566"><span class="hs-identifier hs-var hs-var">lkups</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map TxOutRef ChainIndexTxOut -&gt; ScriptLookups a
forall a. Map TxOutRef ChainIndexTxOut -&gt; ScriptLookups a
</span><span class="hs-identifier hs-var">Pl.unspentOutputs</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef -&gt; ChainIndexTxOut -&gt; Map TxOutRef ChainIndexTxOut
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679560568"><span class="hs-identifier hs-var">oref</span></a></span><span> </span><span class="annot"><span class="annottext">ChainIndexTxOut
</span><a href="#local-6989586621679560567"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>      </span><span id="local-6989586621679560565"><span class="annot"><span class="annottext">constr :: TxConstraints (RedeemerType a) (DatumType a)
</span><a href="#local-6989586621679560565"><span class="hs-identifier hs-var hs-var">constr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; TxConstraints (RedeemerType a) (DatumType a)
forall i o. TxOutRef -&gt; TxConstraints i o
</span><span class="hs-identifier hs-var">Pl.mustSpendPubKeyOutput</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679560568"><span class="hs-identifier hs-var">oref</span></a></span><span>
</span><span id="line-71"></span><span>  </span><span class="annot"><a href="Cooked.Tx.Constraints.html#toLedgerConstraint"><span class="hs-identifier hs-var">toLedgerConstraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tx.Constraints.Type.html#Mints"><span class="hs-identifier hs-type">Mints</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span id="local-6989586621679560562"><span class="annot"><span class="annottext">[MintingPolicy]
</span><a href="#local-6989586621679560562"><span class="hs-identifier hs-var">pols</span></a></span></span><span> </span><span id="local-6989586621679560561"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679560561"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679560560"><span class="hs-identifier hs-var">lkups</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxConstraints (RedeemerType a) (DatumType a)
</span><a href="#local-6989586621679560559"><span class="hs-identifier hs-var">constr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-73"></span><span>      </span><span id="local-6989586621679560560"><span class="annot"><span class="annottext">lkups :: ScriptLookups a
</span><a href="#local-6989586621679560560"><span class="hs-identifier hs-var hs-var">lkups</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MintingPolicy -&gt; ScriptLookups a)
-&gt; [MintingPolicy] -&gt; ScriptLookups a
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">MintingPolicy -&gt; ScriptLookups a
forall a. MintingPolicy -&gt; ScriptLookups a
</span><span class="hs-identifier hs-var">Pl.mintingPolicy</span></span><span> </span><span class="annot"><span class="annottext">[MintingPolicy]
</span><a href="#local-6989586621679560562"><span class="hs-identifier hs-var">pols</span></a></span><span>
</span><span id="line-74"></span><span>      </span><span id="local-6989586621679560559"><span class="annot"><span class="annottext">constr :: TxConstraints (RedeemerType a) (DatumType a)
</span><a href="#local-6989586621679560559"><span class="hs-identifier hs-var hs-var">constr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; TxConstraints (RedeemerType a) (DatumType a)
forall i o. Value -&gt; TxConstraints i o
</span><span class="hs-identifier hs-var">Pl.mustMintValue</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679560561"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-75"></span><span>  </span><span class="annot"><a href="Cooked.Tx.Constraints.html#toLedgerConstraint"><span class="hs-identifier hs-var">toLedgerConstraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tx.Constraints.Type.html#Mints"><span class="hs-identifier hs-type">Mints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679560555"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679560555"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679560554"><span class="annot"><span class="annottext">[MintingPolicy]
</span><a href="#local-6989586621679560554"><span class="hs-identifier hs-var">pols</span></a></span></span><span> </span><span id="local-6989586621679560553"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679560553"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679560552"><span class="hs-identifier hs-var">lkups</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxConstraints (RedeemerType a) (DatumType a)
</span><a href="#local-6989586621679560551"><span class="hs-identifier hs-var">constr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-77"></span><span>      </span><span id="local-6989586621679560552"><span class="annot"><span class="annottext">lkups :: ScriptLookups a
</span><a href="#local-6989586621679560552"><span class="hs-identifier hs-var hs-var">lkups</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MintingPolicy -&gt; ScriptLookups a)
-&gt; [MintingPolicy] -&gt; ScriptLookups a
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">MintingPolicy -&gt; ScriptLookups a
forall a. MintingPolicy -&gt; ScriptLookups a
</span><span class="hs-identifier hs-var">Pl.mintingPolicy</span></span><span> </span><span class="annot"><span class="annottext">[MintingPolicy]
</span><a href="#local-6989586621679560554"><span class="hs-identifier hs-var">pols</span></a></span><span>
</span><span id="line-78"></span><span>      </span><span id="local-6989586621679560551"><span class="annot"><span class="annottext">constr :: TxConstraints (RedeemerType a) (DatumType a)
</span><a href="#local-6989586621679560551"><span class="hs-identifier hs-var hs-var">constr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Redeemer -&gt; Value -&gt; TxConstraints (RedeemerType a) (DatumType a)
forall i o. Redeemer -&gt; Value -&gt; TxConstraints i o
</span><span class="hs-identifier hs-var">Pl.mustMintValueWithRedeemer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinData -&gt; Redeemer
</span><span class="hs-identifier hs-var">Pl.Redeemer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; BuiltinData
forall a. ToData a =&gt; a -&gt; BuiltinData
</span><span class="hs-identifier hs-var">Pl.toBuiltinData</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679560555"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679560553"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-79"></span><span>  </span><span class="annot"><a href="Cooked.Tx.Constraints.html#toLedgerConstraint"><span class="hs-identifier hs-var">toLedgerConstraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tx.Constraints.Type.html#Before"><span class="hs-identifier hs-type">Before</span></a></span><span> </span><span id="local-6989586621679560548"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679560548"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptLookups a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxConstraints (RedeemerType a) (DatumType a)
</span><a href="#local-6989586621679560547"><span class="hs-identifier hs-var">constr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-81"></span><span>      </span><span id="local-6989586621679560547"><span class="annot"><span class="annottext">constr :: TxConstraints (RedeemerType a) (DatumType a)
</span><a href="#local-6989586621679560547"><span class="hs-identifier hs-var hs-var">constr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">POSIXTimeRange -&gt; TxConstraints (RedeemerType a) (DatumType a)
forall i o. POSIXTimeRange -&gt; TxConstraints i o
</span><span class="hs-identifier hs-var">Pl.mustValidateIn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">POSIXTime -&gt; POSIXTimeRange
forall a. a -&gt; Interval a
</span><span class="hs-identifier hs-var">Pl.to</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679560548"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>  </span><span class="annot"><a href="Cooked.Tx.Constraints.html#toLedgerConstraint"><span class="hs-identifier hs-var">toLedgerConstraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tx.Constraints.Type.html#After"><span class="hs-identifier hs-type">After</span></a></span><span> </span><span id="local-6989586621679560543"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679560543"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptLookups a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxConstraints (RedeemerType a) (DatumType a)
</span><a href="#local-6989586621679560542"><span class="hs-identifier hs-var">constr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-84"></span><span>      </span><span id="local-6989586621679560542"><span class="annot"><span class="annottext">constr :: TxConstraints (RedeemerType a) (DatumType a)
</span><a href="#local-6989586621679560542"><span class="hs-identifier hs-var hs-var">constr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">POSIXTimeRange -&gt; TxConstraints (RedeemerType a) (DatumType a)
forall i o. POSIXTimeRange -&gt; TxConstraints i o
</span><span class="hs-identifier hs-var">Pl.mustValidateIn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">POSIXTime -&gt; POSIXTimeRange
forall a. a -&gt; Interval a
</span><span class="hs-identifier hs-var">Pl.from</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679560543"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>  </span><span class="annot"><a href="Cooked.Tx.Constraints.html#toLedgerConstraint"><span class="hs-identifier hs-var">toLedgerConstraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tx.Constraints.Type.html#ValidateIn"><span class="hs-identifier hs-type">ValidateIn</span></a></span><span> </span><span id="local-6989586621679560539"><span class="annot"><span class="annottext">POSIXTimeRange
</span><a href="#local-6989586621679560539"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptLookups a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">POSIXTimeRange -&gt; TxConstraints (RedeemerType a) (DatumType a)
forall i o. POSIXTimeRange -&gt; TxConstraints i o
</span><span class="hs-identifier hs-var">Pl.mustValidateIn</span></span><span> </span><span class="annot"><span class="annottext">POSIXTimeRange
</span><a href="#local-6989586621679560539"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>  </span><span class="annot"><a href="Cooked.Tx.Constraints.html#toLedgerConstraint"><span class="hs-identifier hs-var">toLedgerConstraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tx.Constraints.Type.html#SignedBy"><span class="hs-identifier hs-type">SignedBy</span></a></span><span> </span><span id="local-6989586621679560537"><span class="annot"><span class="annottext">[PubKeyHash]
</span><a href="#local-6989586621679560537"><span class="hs-identifier hs-var">hashes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptLookups a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(PubKeyHash -&gt; TxConstraints (RedeemerType a) (DatumType a))
-&gt; [PubKeyHash] -&gt; TxConstraints (RedeemerType a) (DatumType a)
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PaymentPubKeyHash -&gt; TxConstraints (RedeemerType a) (DatumType a)
forall i o. PaymentPubKeyHash -&gt; TxConstraints i o
</span><span class="hs-identifier hs-var">Pl.mustBeSignedBy</span></span><span> </span><span class="annot"><span class="annottext">(PaymentPubKeyHash -&gt; TxConstraints (RedeemerType a) (DatumType a))
-&gt; (PubKeyHash -&gt; PaymentPubKeyHash)
-&gt; PubKeyHash
-&gt; TxConstraints (RedeemerType a) (DatumType a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PubKeyHash -&gt; PaymentPubKeyHash
</span><span class="hs-identifier hs-var">Pl.PaymentPubKeyHash</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PubKeyHash]
</span><a href="#local-6989586621679560537"><span class="hs-identifier hs-var">hashes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cooked.Tx.Constraints.html#ToLedgerConstraint"><span class="hs-identifier hs-type">ToLedgerConstraint</span></a></span><span> </span><span class="annot"><a href="Cooked.Tx.Constraints.Type.html#OutConstraint"><span class="hs-identifier hs-type">OutConstraint</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-89"></span><span>  </span><span id="local-6989586621679560532"><span class="annot"><span class="annottext">extractDatumStr :: OutConstraint -&gt; Map DatumHash String
</span><a href="#local-6989586621679560532"><span class="hs-identifier hs-var hs-var hs-var hs-var">extractDatumStr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tx.Constraints.Type.html#PaysScript"><span class="hs-identifier hs-type">PaysScript</span></a></span><span> </span><span id="local-6989586621679560530"><span class="annot"><span class="annottext">TypedValidator a
</span><a href="#local-6989586621679560530"><span class="hs-identifier hs-var">_validator</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe StakingCredential
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679560529"><span class="annot"><span class="annottext">DatumType a
</span><a href="#local-6989586621679560529"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span id="local-6989586621679560528"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679560528"><span class="hs-identifier hs-var">_value</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-90"></span><span>    </span><span class="annot"><span class="annottext">DatumHash -&gt; String -&gt; Map DatumHash String
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Datum -&gt; DatumHash
</span><span class="hs-identifier hs-var">Pl.datumHash</span></span><span> </span><span class="annot"><span class="annottext">(Datum -&gt; DatumHash)
-&gt; (DatumType a -&gt; Datum) -&gt; DatumType a -&gt; DatumHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BuiltinData -&gt; Datum
</span><span class="hs-identifier hs-var">Pl.Datum</span></span><span> </span><span class="annot"><span class="annottext">(BuiltinData -&gt; Datum)
-&gt; (DatumType a -&gt; BuiltinData) -&gt; DatumType a -&gt; Datum
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DatumType a -&gt; BuiltinData
forall a. ToData a =&gt; a -&gt; BuiltinData
</span><span class="hs-identifier hs-var">Pl.toBuiltinData</span></span><span> </span><span class="annot"><span class="annottext">(DatumType a -&gt; DatumHash) -&gt; DatumType a -&gt; DatumHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DatumType a
</span><a href="#local-6989586621679560529"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DatumType a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">DatumType a
</span><a href="#local-6989586621679560529"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>  </span><span class="annot"><a href="Cooked.Tx.Constraints.html#extractDatumStr"><span class="hs-identifier hs-var">extractDatumStr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tx.Constraints.Type.html#PaysPKWithDatum"><span class="hs-identifier hs-type">PaysPKWithDatum</span></a></span><span> </span><span id="local-6989586621679560526"><span class="annot"><span class="annottext">PubKeyHash
</span><a href="#local-6989586621679560526"><span class="hs-identifier hs-var">_pk</span></a></span></span><span> </span><span id="local-6989586621679560525"><span class="annot"><span class="annottext">Maybe StakePubKeyHash
</span><a href="#local-6989586621679560525"><span class="hs-identifier hs-var">_stak</span></a></span></span><span> </span><span id="local-6989586621679560524"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679560524"><span class="hs-identifier hs-var">mdat</span></a></span></span><span> </span><span id="local-6989586621679560523"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679560523"><span class="hs-identifier hs-var">_v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-92"></span><span>    </span><span class="annot"><span class="annottext">Map DatumHash String
-&gt; (a -&gt; Map DatumHash String) -&gt; Maybe a -&gt; Map DatumHash String
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Map DatumHash String
forall k a. Map k a
</span><span class="hs-identifier hs-var">M.empty</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679560521"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679560521"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DatumHash -&gt; String -&gt; Map DatumHash String
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Datum -&gt; DatumHash
</span><span class="hs-identifier hs-var">Pl.datumHash</span></span><span> </span><span class="annot"><span class="annottext">(Datum -&gt; DatumHash)
-&gt; (BuiltinData -&gt; Datum) -&gt; BuiltinData -&gt; DatumHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BuiltinData -&gt; Datum
</span><span class="hs-identifier hs-var">Pl.Datum</span></span><span> </span><span class="annot"><span class="annottext">(BuiltinData -&gt; DatumHash) -&gt; BuiltinData -&gt; DatumHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; BuiltinData
forall a. ToData a =&gt; a -&gt; BuiltinData
</span><span class="hs-identifier hs-var">Pl.toBuiltinData</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679560521"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679560521"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679560524"><span class="hs-identifier hs-var">mdat</span></a></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span>  </span><span id="local-6989586621679560520"><span class="annot"><span class="annottext">toLedgerConstraint :: OutConstraint -&gt; LedgerConstraint a
</span><a href="#local-6989586621679560520"><span class="hs-identifier hs-var hs-var hs-var hs-var">toLedgerConstraint</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tx.Constraints.Type.html#PaysPKWithDatum"><span class="hs-identifier hs-type">PaysPKWithDatum</span></a></span><span> </span><span id="local-6989586621679560519"><span class="annot"><span class="annottext">PubKeyHash
</span><a href="#local-6989586621679560519"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679560518"><span class="annot"><span class="annottext">Maybe StakePubKeyHash
</span><a href="#local-6989586621679560518"><span class="hs-identifier hs-var">stak</span></a></span></span><span> </span><span id="local-6989586621679560517"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679560517"><span class="hs-identifier hs-var">dat</span></a></span></span><span> </span><span id="local-6989586621679560516"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679560516"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679560515"><span class="hs-identifier hs-var">lkups</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxConstraints (RedeemerType a) (DatumType a)
</span><a href="#local-6989586621679560514"><span class="hs-identifier hs-var">constr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-96"></span><span>      </span><span id="local-6989586621679560513"><span class="annot"><span class="annottext">mData :: Maybe Datum
</span><a href="#local-6989586621679560513"><span class="hs-identifier hs-var hs-var">mData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Datum) -&gt; Maybe a -&gt; Maybe Datum
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinData -&gt; Datum
</span><span class="hs-identifier hs-var">Pl.Datum</span></span><span> </span><span class="annot"><span class="annottext">(BuiltinData -&gt; Datum) -&gt; (a -&gt; BuiltinData) -&gt; a -&gt; Datum
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; BuiltinData
forall a. ToData a =&gt; a -&gt; BuiltinData
</span><span class="hs-identifier hs-var">Pl.toBuiltinData</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679560517"><span class="hs-identifier hs-var">dat</span></a></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span>      </span><span id="local-6989586621679560515"><span class="annot"><span class="annottext">lkups :: ScriptLookups a
</span><a href="#local-6989586621679560515"><span class="hs-identifier hs-var hs-var">lkups</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-99"></span><span>        </span><span class="annot"><span class="annottext">ScriptLookups a
-&gt; (Datum -&gt; ScriptLookups a) -&gt; Maybe Datum -&gt; ScriptLookups a
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Datum -&gt; ScriptLookups a
forall a. Datum -&gt; ScriptLookups a
</span><span class="hs-identifier hs-var">Pl.otherData</span></span><span> </span><span class="annot"><span class="annottext">Maybe Datum
</span><a href="#local-6989586621679560513"><span class="hs-identifier hs-var">mData</span></a></span><span>
</span><span id="line-100"></span><span>          </span><span class="hs-comment">-- TODO: do we want to akk ownStakePubKeyHash on 'PaysPKWithDatum'? Would we rather have</span><span>
</span><span id="line-101"></span><span>          </span><span class="hs-comment">-- a different 'WithOwnStakePubKeyHash' constraint?</span><span>
</span><span id="line-102"></span><span>          </span><span class="annot"><span class="annottext">ScriptLookups a -&gt; ScriptLookups a -&gt; ScriptLookups a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a
-&gt; (StakePubKeyHash -&gt; ScriptLookups a)
-&gt; Maybe StakePubKeyHash
-&gt; ScriptLookups a
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">StakePubKeyHash -&gt; ScriptLookups a
forall a. StakePubKeyHash -&gt; ScriptLookups a
</span><span class="hs-identifier hs-var">Pl.ownStakePubKeyHash</span></span><span> </span><span class="annot"><span class="annottext">Maybe StakePubKeyHash
</span><a href="#local-6989586621679560518"><span class="hs-identifier hs-var">stak</span></a></span><span>
</span><span id="line-103"></span><span>      </span><span id="local-6989586621679560514"><span class="annot"><span class="annottext">constr :: TxConstraints (RedeemerType a) (DatumType a)
</span><a href="#local-6989586621679560514"><span class="hs-identifier hs-var hs-var">constr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxConstraint -&gt; TxConstraints (RedeemerType a) (DatumType a)
forall i o. TxConstraint -&gt; TxConstraints i o
</span><span class="hs-identifier hs-var">Pl.singleton</span></span><span> </span><span class="annot"><span class="annottext">(TxConstraint -&gt; TxConstraints (RedeemerType a) (DatumType a))
-&gt; TxConstraint -&gt; TxConstraints (RedeemerType a) (DatumType a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PaymentPubKeyHash
-&gt; Maybe StakePubKeyHash -&gt; Maybe Datum -&gt; Value -&gt; TxConstraint
</span><span class="hs-identifier hs-var">Pl.MustPayToPubKeyAddress</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PubKeyHash -&gt; PaymentPubKeyHash
</span><span class="hs-identifier hs-var">Pl.PaymentPubKeyHash</span></span><span> </span><span class="annot"><span class="annottext">PubKeyHash
</span><a href="#local-6989586621679560519"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe StakePubKeyHash
</span><a href="#local-6989586621679560518"><span class="hs-identifier hs-var">stak</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Datum
</span><a href="#local-6989586621679560513"><span class="hs-identifier hs-var">mData</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679560516"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-104"></span><span>  </span><span class="annot"><a href="Cooked.Tx.Constraints.html#toLedgerConstraint"><span class="hs-identifier hs-var">toLedgerConstraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tx.Constraints.Type.html#PaysScript"><span class="hs-identifier hs-type">PaysScript</span></a></span><span> </span><span id="local-6989586621679560508"><span class="annot"><span class="annottext">TypedValidator a
</span><a href="#local-6989586621679560508"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679560507"><span class="annot"><span class="annottext">Maybe StakingCredential
</span><a href="#local-6989586621679560507"><span class="hs-identifier hs-var">msc</span></a></span></span><span> </span><span id="local-6989586621679560506"><span class="annot"><span class="annottext">DatumType a
</span><a href="#local-6989586621679560506"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span id="local-6989586621679560505"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679560505"><span class="hs-identifier hs-var">value</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679560504"><span class="hs-identifier hs-var">lkups</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxConstraints (RedeemerType a) (DatumType a)
</span><a href="#local-6989586621679560503"><span class="hs-identifier hs-var">constr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-106"></span><span>      </span><span id="local-6989586621679560504"><span class="annot"><span class="annottext">lkups :: ScriptLookups a
</span><a href="#local-6989586621679560504"><span class="hs-identifier hs-var hs-var">lkups</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Validator -&gt; ScriptLookups a
forall a. Validator -&gt; ScriptLookups a
</span><span class="hs-identifier hs-var">Pl.otherScript</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypedValidator a -&gt; Validator
forall a. TypedValidator a -&gt; Validator
</span><span class="hs-identifier hs-var">Pl.validatorScript</span></span><span> </span><span class="annot"><span class="annottext">TypedValidator a
</span><a href="#local-6989586621679560508"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>      </span><span id="local-6989586621679560503"><span class="annot"><span class="annottext">constr :: TxConstraints (RedeemerType a) (DatumType a)
</span><a href="#local-6989586621679560503"><span class="hs-identifier hs-var hs-var">constr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-108"></span><span>        </span><span class="annot"><span class="annottext">TxConstraint -&gt; TxConstraints (RedeemerType a) (DatumType a)
forall i o. TxConstraint -&gt; TxConstraints i o
</span><span class="hs-identifier hs-var">Pl.singleton</span></span><span>
</span><span id="line-109"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ValidatorHash
-&gt; Maybe StakeValidatorHash -&gt; Datum -&gt; Value -&gt; TxConstraint
</span><span class="hs-identifier hs-var">Pl.MustPayToOtherScript</span></span><span>
</span><span id="line-110"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Validator -&gt; ValidatorHash
</span><span class="hs-identifier hs-var">Pl.validatorHash</span></span><span> </span><span class="annot"><span class="annottext">(Validator -&gt; ValidatorHash) -&gt; Validator -&gt; ValidatorHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypedValidator a -&gt; Validator
forall a. TypedValidator a -&gt; Validator
</span><span class="hs-identifier hs-var">Pl.validatorScript</span></span><span> </span><span class="annot"><span class="annottext">TypedValidator a
</span><a href="#local-6989586621679560508"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe StakingCredential
</span><a href="#local-6989586621679560507"><span class="hs-identifier hs-var">msc</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe StakingCredential
-&gt; (StakingCredential -&gt; Maybe StakeValidatorHash)
-&gt; Maybe StakeValidatorHash
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">StakingCredential -&gt; Maybe StakeValidatorHash
</span><a href="#local-6989586621679560500"><span class="hs-identifier hs-var">getStakeValidatorHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinData -&gt; Datum
</span><span class="hs-identifier hs-var">Pl.Datum</span></span><span> </span><span class="annot"><span class="annottext">(BuiltinData -&gt; Datum) -&gt; BuiltinData -&gt; Datum
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DatumType a -&gt; BuiltinData
forall a. ToData a =&gt; a -&gt; BuiltinData
</span><span class="hs-identifier hs-var">Pl.toBuiltinData</span></span><span> </span><span class="annot"><span class="annottext">DatumType a
</span><a href="#local-6989586621679560506"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>              </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679560505"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-114"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>          </span><span class="annot"><span class="annottext">TxConstraints (RedeemerType a) (DatumType a)
-&gt; TxConstraints (RedeemerType a) (DatumType a)
-&gt; TxConstraints (RedeemerType a) (DatumType a)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TxConstraint -&gt; TxConstraints (RedeemerType a) (DatumType a)
forall i o. TxConstraint -&gt; TxConstraints i o
</span><span class="hs-identifier hs-var">Pl.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Datum -&gt; TxConstraint
</span><span class="hs-identifier hs-var">Pl.MustIncludeDatum</span></span><span> </span><span class="annot"><span class="annottext">(Datum -&gt; TxConstraint) -&gt; Datum -&gt; TxConstraint
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BuiltinData -&gt; Datum
</span><span class="hs-identifier hs-var">Pl.Datum</span></span><span> </span><span class="annot"><span class="annottext">(BuiltinData -&gt; Datum) -&gt; BuiltinData -&gt; Datum
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DatumType a -&gt; BuiltinData
forall a. ToData a =&gt; a -&gt; BuiltinData
</span><span class="hs-identifier hs-var">Pl.toBuiltinData</span></span><span> </span><span class="annot"><span class="annottext">DatumType a
</span><a href="#local-6989586621679560506"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>      </span><span class="hs-comment">-- Retrieve StakeValidatorHash from StakingCredential. This is similar to what plutus-apps does.</span><span>
</span><span id="line-117"></span><span>      </span><span class="hs-comment">-- See lines 141-146 in plutus-apps/plutus-ledger-constraints/test/Spec.hs (commit hash 02ae267)</span><span>
</span><span id="line-118"></span><span>      </span><span class="annot"><a href="#local-6989586621679560500"><span class="hs-identifier hs-type">getStakeValidatorHash</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pl.StakingCredential</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pl.StakeValidatorHash</span></span><span>
</span><span id="line-119"></span><span>      </span><span id="local-6989586621679560500"><span class="annot"><span class="annottext">getStakeValidatorHash :: StakingCredential -&gt; Maybe StakeValidatorHash
</span><a href="#local-6989586621679560500"><span class="hs-identifier hs-var hs-var">getStakeValidatorHash</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pl.StakingHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pl.ScriptCredential</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pl.ValidatorHash</span></span><span> </span><span id="local-6989586621679560495"><span class="annot"><span class="annottext">BuiltinByteString
</span><a href="#local-6989586621679560495"><span class="hs-identifier hs-var">svh</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-120"></span><span>        </span><span class="annot"><span class="annottext">StakeValidatorHash -&gt; Maybe StakeValidatorHash
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(StakeValidatorHash -&gt; Maybe StakeValidatorHash)
-&gt; StakeValidatorHash -&gt; Maybe StakeValidatorHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BuiltinByteString -&gt; StakeValidatorHash
</span><span class="hs-identifier hs-var">Pl.StakeValidatorHash</span></span><span> </span><span class="annot"><span class="annottext">BuiltinByteString
</span><a href="#local-6989586621679560495"><span class="hs-identifier hs-var">svh</span></a></span><span>
</span><span id="line-121"></span><span>      </span><span class="annot"><a href="#local-6989586621679560500"><span class="hs-identifier hs-var">getStakeValidatorHash</span></a></span><span> </span><span class="annot"><span class="annottext">StakingCredential
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe StakeValidatorHash
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cooked.Tx.Constraints.html#ToLedgerConstraint"><span class="hs-identifier hs-type">ToLedgerConstraint</span></a></span><span> </span><span class="annot"><a href="Cooked.Tx.Constraints.Type.html#Constraints"><span class="hs-identifier hs-type">Constraints</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-124"></span><span>  </span><span id="local-6989586621679560491"><span class="annot"><span class="annottext">extractDatumStr :: Constraints -&gt; Map DatumHash String
</span><a href="#local-6989586621679560491"><span class="hs-identifier hs-var hs-var hs-var hs-var">extractDatumStr</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679560490"><span class="annot"><span class="annottext">[MiscConstraint]
</span><a href="#local-6989586621679560490"><span class="hs-identifier hs-var">miscConstraints</span></a></span></span><span> </span><span class="annot"><a href="Cooked.Tx.Constraints.Type.html#%3A%3D%3E%3A"><span class="hs-operator hs-type">:=&gt;:</span></a></span><span> </span><span id="local-6989586621679560488"><span class="annot"><span class="annottext">[OutConstraint]
</span><a href="#local-6989586621679560488"><span class="hs-identifier hs-var">outConstraints</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-125"></span><span>    </span><span class="annot"><span class="annottext">Map DatumHash String
-&gt; Map DatumHash String -&gt; Map DatumHash String
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.union</span></span><span>
</span><span id="line-126"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Map DatumHash String] -&gt; Map DatumHash String
forall (f :: * -&gt; *) k a.
(Foldable f, Ord k) =&gt;
f (Map k a) -&gt; Map k a
</span><span class="hs-identifier hs-var">M.unions</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MiscConstraint -&gt; Map DatumHash String
forall constraint.
ToLedgerConstraint constraint =&gt;
constraint -&gt; Map DatumHash String
</span><a href="Cooked.Tx.Constraints.html#extractDatumStr"><span class="hs-identifier hs-var">extractDatumStr</span></a></span><span> </span><span class="annot"><span class="annottext">(MiscConstraint -&gt; Map DatumHash String)
-&gt; [MiscConstraint] -&gt; [Map DatumHash String]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[MiscConstraint]
</span><a href="#local-6989586621679560490"><span class="hs-identifier hs-var">miscConstraints</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Map DatumHash String] -&gt; Map DatumHash String
forall (f :: * -&gt; *) k a.
(Foldable f, Ord k) =&gt;
f (Map k a) -&gt; Map k a
</span><span class="hs-identifier hs-var">M.unions</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OutConstraint -&gt; Map DatumHash String
forall constraint.
ToLedgerConstraint constraint =&gt;
constraint -&gt; Map DatumHash String
</span><a href="Cooked.Tx.Constraints.html#extractDatumStr"><span class="hs-identifier hs-var">extractDatumStr</span></a></span><span> </span><span class="annot"><span class="annottext">(OutConstraint -&gt; Map DatumHash String)
-&gt; [OutConstraint] -&gt; [Map DatumHash String]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[OutConstraint]
</span><a href="#local-6989586621679560488"><span class="hs-identifier hs-var">outConstraints</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span>  </span><span id="local-6989586621679560484"><span class="annot"><span class="annottext">toLedgerConstraint :: Constraints -&gt; LedgerConstraint a
</span><a href="#local-6989586621679560484"><span class="hs-identifier hs-var hs-var hs-var hs-var">toLedgerConstraint</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679560483"><span class="annot"><span class="annottext">[MiscConstraint]
</span><a href="#local-6989586621679560483"><span class="hs-identifier hs-var">miscConstraints</span></a></span></span><span> </span><span class="annot"><a href="Cooked.Tx.Constraints.Type.html#%3A%3D%3E%3A"><span class="hs-operator hs-type">:=&gt;:</span></a></span><span> </span><span id="local-6989586621679560482"><span class="annot"><span class="annottext">[OutConstraint]
</span><a href="#local-6989586621679560482"><span class="hs-identifier hs-var">outConstraints</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ScriptLookups a] -&gt; ScriptLookups a
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">[ScriptLookups a]
</span><a href="#local-6989586621679560481"><span class="hs-identifier hs-var">lkups</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TxConstraints (RedeemerType a) (DatumType a)]
-&gt; TxConstraints (RedeemerType a) (DatumType a)
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">[TxConstraints (RedeemerType a) (DatumType a)]
</span><a href="#local-6989586621679560480"><span class="hs-identifier hs-var">constrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-132"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679560481"><span class="annot"><span class="annottext">[ScriptLookups a]
</span><a href="#local-6989586621679560481"><span class="hs-identifier hs-var">lkups</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679560480"><span class="annot"><span class="annottext">[TxConstraints (RedeemerType a) (DatumType a)]
</span><a href="#local-6989586621679560480"><span class="hs-identifier hs-var">constrs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-133"></span><span>        </span><span class="annot"><span class="annottext">[LedgerConstraint a]
-&gt; ([ScriptLookups a],
    [TxConstraints (RedeemerType a) (DatumType a)])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">([LedgerConstraint a]
 -&gt; ([ScriptLookups a],
     [TxConstraints (RedeemerType a) (DatumType a)]))
-&gt; [LedgerConstraint a]
-&gt; ([ScriptLookups a],
    [TxConstraints (RedeemerType a) (DatumType a)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-134"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MiscConstraint -&gt; LedgerConstraint a
forall constraint a.
ToLedgerConstraint constraint =&gt;
constraint -&gt; LedgerConstraint a
</span><a href="Cooked.Tx.Constraints.html#toLedgerConstraint"><span class="hs-identifier hs-var">toLedgerConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">(MiscConstraint -&gt; LedgerConstraint a)
-&gt; [MiscConstraint] -&gt; [LedgerConstraint a]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[MiscConstraint]
</span><a href="#local-6989586621679560483"><span class="hs-identifier hs-var">miscConstraints</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>            </span><span class="annot"><span class="annottext">[LedgerConstraint a]
-&gt; [LedgerConstraint a] -&gt; [LedgerConstraint a]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OutConstraint -&gt; LedgerConstraint a
forall constraint a.
ToLedgerConstraint constraint =&gt;
constraint -&gt; LedgerConstraint a
</span><a href="Cooked.Tx.Constraints.html#toLedgerConstraint"><span class="hs-identifier hs-var">toLedgerConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">(OutConstraint -&gt; LedgerConstraint a)
-&gt; [OutConstraint] -&gt; [LedgerConstraint a]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[OutConstraint]
</span><a href="#local-6989586621679560482"><span class="hs-identifier hs-var">outConstraints</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="hs-comment">-- | Generate the 'Pl.TxOut' transaction output associated to a given output</span><span>
</span><span id="line-138"></span><span class="hs-comment">-- constraint 'OutConstraint'.</span><span>
</span><span id="line-139"></span><span class="annot"><a href="Cooked.Tx.Constraints.html#outConstraintToTxOut"><span class="hs-identifier hs-type">outConstraintToTxOut</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.Tx.Constraints.Type.html#OutConstraint"><span class="hs-identifier hs-type">OutConstraint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pl.TxOut</span></span><span>
</span><span id="line-140"></span><span id="outConstraintToTxOut"><span class="annot"><span class="annottext">outConstraintToTxOut :: OutConstraint -&gt; TxOut
</span><a href="Cooked.Tx.Constraints.html#outConstraintToTxOut"><span class="hs-identifier hs-var hs-var">outConstraintToTxOut</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tx.Constraints.Type.html#PaysPKWithDatum"><span class="hs-identifier hs-type">PaysPKWithDatum</span></a></span><span> </span><span id="local-6989586621679560477"><span class="annot"><span class="annottext">PubKeyHash
</span><a href="#local-6989586621679560477"><span class="hs-identifier hs-var">pkh</span></a></span></span><span> </span><span id="local-6989586621679560476"><span class="annot"><span class="annottext">Maybe StakePubKeyHash
</span><a href="#local-6989586621679560476"><span class="hs-identifier hs-var">mStakePkh</span></a></span></span><span> </span><span id="local-6989586621679560475"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679560475"><span class="hs-identifier hs-var">mDatum</span></a></span></span><span> </span><span id="local-6989586621679560474"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679560474"><span class="hs-identifier hs-var">value</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-141"></span><span>  </span><span class="annot"><span class="annottext">TxOut :: Address -&gt; Value -&gt; Maybe DatumHash -&gt; TxOut
</span><span class="hs-identifier hs-type">Pl.TxOut</span></span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">txOutAddress :: Address
</span><span class="hs-identifier hs-var">Pl.txOutAddress</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-143"></span><span>        </span><span class="annot"><span class="annottext">Credential -&gt; Maybe StakingCredential -&gt; Address
</span><span class="hs-identifier hs-var">Pl.Address</span></span><span>
</span><span id="line-144"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PubKeyHash -&gt; Credential
</span><span class="hs-identifier hs-var">Pl.PubKeyCredential</span></span><span> </span><span class="annot"><span class="annottext">PubKeyHash
</span><a href="#local-6989586621679560477"><span class="hs-identifier hs-var">pkh</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Credential -&gt; StakingCredential
</span><span class="hs-identifier hs-var">Pl.StakingHash</span></span><span> </span><span class="annot"><span class="annottext">(Credential -&gt; StakingCredential)
-&gt; (StakePubKeyHash -&gt; Credential)
-&gt; StakePubKeyHash
-&gt; StakingCredential
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PubKeyHash -&gt; Credential
</span><span class="hs-identifier hs-var">Pl.PubKeyCredential</span></span><span> </span><span class="annot"><span class="annottext">(PubKeyHash -&gt; Credential)
-&gt; (StakePubKeyHash -&gt; PubKeyHash) -&gt; StakePubKeyHash -&gt; Credential
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">StakePubKeyHash -&gt; PubKeyHash
</span><span class="hs-identifier hs-var hs-var">Pl.unStakePubKeyHash</span></span><span> </span><span class="annot"><span class="annottext">(StakePubKeyHash -&gt; StakingCredential)
-&gt; Maybe StakePubKeyHash -&gt; Maybe StakingCredential
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe StakePubKeyHash
</span><a href="#local-6989586621679560476"><span class="hs-identifier hs-var">mStakePkh</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-146"></span><span>      </span><span class="annot"><span class="annottext">txOutValue :: Value
</span><span class="hs-identifier hs-var">Pl.txOutValue</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679560474"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-147"></span><span>      </span><span class="annot"><span class="annottext">txOutDatumHash :: Maybe DatumHash
</span><span class="hs-identifier hs-var">Pl.txOutDatumHash</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Datum -&gt; DatumHash
</span><span class="hs-identifier hs-var">Pl.datumHash</span></span><span> </span><span class="annot"><span class="annottext">(Datum -&gt; DatumHash) -&gt; (a -&gt; Datum) -&gt; a -&gt; DatumHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BuiltinData -&gt; Datum
</span><span class="hs-identifier hs-var">Pl.Datum</span></span><span> </span><span class="annot"><span class="annottext">(BuiltinData -&gt; Datum) -&gt; (a -&gt; BuiltinData) -&gt; a -&gt; Datum
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; BuiltinData
forall a. ToData a =&gt; a -&gt; BuiltinData
</span><span class="hs-identifier hs-var">Pl.toBuiltinData</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; DatumHash) -&gt; Maybe a -&gt; Maybe DatumHash
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679560475"><span class="hs-identifier hs-var">mDatum</span></a></span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-149"></span><span class="annot"><a href="Cooked.Tx.Constraints.html#outConstraintToTxOut"><span class="hs-identifier hs-var">outConstraintToTxOut</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tx.Constraints.Type.html#PaysScript"><span class="hs-identifier hs-type">PaysScript</span></a></span><span> </span><span id="local-6989586621679560466"><span class="annot"><span class="annottext">TypedValidator a
</span><a href="#local-6989586621679560466"><span class="hs-identifier hs-var">validator</span></a></span></span><span> </span><span id="local-6989586621679560465"><span class="annot"><span class="annottext">Maybe StakingCredential
</span><a href="#local-6989586621679560465"><span class="hs-identifier hs-var">msc</span></a></span></span><span> </span><span id="local-6989586621679560464"><span class="annot"><span class="annottext">DatumType a
</span><a href="#local-6989586621679560464"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span id="local-6989586621679560463"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679560463"><span class="hs-identifier hs-var">value</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-150"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679560462"><span class="annot"><span class="annottext">outAddr :: Address
</span><a href="#local-6989586621679560462"><span class="hs-identifier hs-var hs-var">outAddr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe StakingCredential -&gt; Address -&gt; Address
</span><a href="#local-6989586621679560461"><span class="hs-identifier hs-var">appendStakingCredential</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe StakingCredential
</span><a href="#local-6989586621679560465"><span class="hs-identifier hs-var">msc</span></a></span><span> </span><span class="annot"><span class="annottext">(Address -&gt; Address) -&gt; Address -&gt; Address
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ValidatorHash -&gt; Address
</span><span class="hs-identifier hs-var">Pl.scriptHashAddress</span></span><span> </span><span class="annot"><span class="annottext">(ValidatorHash -&gt; Address) -&gt; ValidatorHash -&gt; Address
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Validator -&gt; ValidatorHash
</span><span class="hs-identifier hs-var">Pl.validatorHash</span></span><span> </span><span class="annot"><span class="annottext">(Validator -&gt; ValidatorHash) -&gt; Validator -&gt; ValidatorHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypedValidator a -&gt; Validator
forall a. TypedValidator a -&gt; Validator
</span><span class="hs-identifier hs-var">Pl.validatorScript</span></span><span> </span><span class="annot"><span class="annottext">TypedValidator a
</span><a href="#local-6989586621679560466"><span class="hs-identifier hs-var">validator</span></a></span><span>
</span><span id="line-151"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">TxOut :: Address -&gt; Value -&gt; Maybe DatumHash -&gt; TxOut
</span><span class="hs-identifier hs-type">Pl.TxOut</span></span><span>
</span><span id="line-152"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">txOutAddress :: Address
</span><span class="hs-identifier hs-var">Pl.txOutAddress</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679560462"><span class="hs-identifier hs-var">outAddr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-153"></span><span>          </span><span class="annot"><span class="annottext">txOutValue :: Value
</span><span class="hs-identifier hs-var">Pl.txOutValue</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679560463"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-154"></span><span>          </span><span class="annot"><span class="annottext">txOutDatumHash :: Maybe DatumHash
</span><span class="hs-identifier hs-var">Pl.txOutDatumHash</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DatumHash -&gt; Maybe DatumHash
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(DatumHash -&gt; Maybe DatumHash)
-&gt; (DatumType a -&gt; DatumHash) -&gt; DatumType a -&gt; Maybe DatumHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Datum -&gt; DatumHash
</span><span class="hs-identifier hs-var">Pl.datumHash</span></span><span> </span><span class="annot"><span class="annottext">(Datum -&gt; DatumHash)
-&gt; (DatumType a -&gt; Datum) -&gt; DatumType a -&gt; DatumHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BuiltinData -&gt; Datum
</span><span class="hs-identifier hs-var">Pl.Datum</span></span><span> </span><span class="annot"><span class="annottext">(BuiltinData -&gt; Datum)
-&gt; (DatumType a -&gt; BuiltinData) -&gt; DatumType a -&gt; Datum
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DatumType a -&gt; BuiltinData
forall a. ToData a =&gt; a -&gt; BuiltinData
</span><span class="hs-identifier hs-var">Pl.toBuiltinData</span></span><span> </span><span class="annot"><span class="annottext">(DatumType a -&gt; Maybe DatumHash) -&gt; DatumType a -&gt; Maybe DatumHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DatumType a
</span><a href="#local-6989586621679560464"><span class="hs-identifier hs-var">datum</span></a></span><span>
</span><span id="line-155"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-157"></span><span>    </span><span class="annot"><a href="#local-6989586621679560461"><span class="hs-identifier hs-type">appendStakingCredential</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pl.StakingCredential</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pl.Address</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pl.Address</span></span><span>
</span><span id="line-158"></span><span>    </span><span id="local-6989586621679560461"><span class="annot"><span class="annottext">appendStakingCredential :: Maybe StakingCredential -&gt; Address -&gt; Address
</span><a href="#local-6989586621679560461"><span class="hs-identifier hs-var hs-var">appendStakingCredential</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe StakingCredential
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span id="local-6989586621679560459"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679560459"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679560459"><span class="hs-identifier hs-var">addr</span></a></span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><a href="#local-6989586621679560461"><span class="hs-identifier hs-var">appendStakingCredential</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679560458"><span class="annot"><span class="annottext">StakingCredential
</span><a href="#local-6989586621679560458"><span class="hs-identifier hs-var">sc</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679560457"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679560457"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679560457"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">addressStakingCredential :: Maybe StakingCredential
</span><span class="hs-identifier hs-var">Pl.addressStakingCredential</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StakingCredential -&gt; Maybe StakingCredential
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">StakingCredential
</span><a href="#local-6989586621679560458"><span class="hs-identifier hs-var">sc</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="hs-comment">-- | Reorders the outputs of a transaction according to the ordered list of</span><span>
</span><span id="line-162"></span><span class="hs-comment">-- output constraints that generate them. Fails in case of mismatch. The</span><span>
</span><span id="line-163"></span><span class="hs-comment">-- reordered outputs are put at the beginning of the list.</span><span>
</span><span id="line-164"></span><span class="hs-comment">-- orderTxOutputs :: MonadFail m =&gt; [OutConstraint] -&gt; [Pl.TxOut] -&gt; m [Pl.TxOut]</span><span>
</span><span id="line-165"></span><span class="hs-comment">-- -- TODO Check staking credentials</span><span>
</span><span id="line-166"></span><span class="hs-comment">-- orderTxOutputs [] txOuts = return txOuts</span><span>
</span><span id="line-167"></span><span class="hs-comment">-- orderTxOutputs (oc : ocs) txOuts =</span><span>
</span><span id="line-168"></span><span class="hs-comment">--   case findGeneratedTxOutput oc txOuts of</span><span>
</span><span id="line-169"></span><span class="hs-comment">--     Nothing -&gt;</span><span>
</span><span id="line-170"></span><span class="hs-comment">--       fail $</span><span>
</span><span id="line-171"></span><span class="hs-comment">--         &quot;Could not locate output corresponding to constraint &quot;</span><span>
</span><span id="line-172"></span><span class="hs-comment">--           &lt;&gt; show (prettyOutConstraint oc)</span><span>
</span><span id="line-173"></span><span class="hs-comment">--     Just txOut -&gt; (txOut :) &lt;$&gt; orderTxOutputs ocs (List.delete txOut txOuts)</span><span>
</span><span id="line-174"></span><span class="annot"><a href="Cooked.Tx.Constraints.html#orderTxOutputs"><span class="hs-identifier hs-type">orderTxOutputs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cooked.Tx.Constraints.Type.html#OutConstraint"><span class="hs-identifier hs-type">OutConstraint</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Pl.TxOut</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Pl.TxOut</span></span><span class="hs-special">]</span><span>
</span><span id="line-175"></span><span id="orderTxOutputs"><span class="annot"><span class="annottext">orderTxOutputs :: [OutConstraint] -&gt; [TxOut] -&gt; [TxOut]
</span><a href="Cooked.Tx.Constraints.html#orderTxOutputs"><span class="hs-identifier hs-var hs-var">orderTxOutputs</span></a></span></span><span> </span><span id="local-6989586621679560455"><span class="annot"><span class="annottext">[OutConstraint]
</span><a href="#local-6989586621679560455"><span class="hs-identifier hs-var">expected</span></a></span></span><span> </span><span id="local-6989586621679560454"><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621679560454"><span class="hs-identifier hs-var">given</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679560453"><span class="annot"><span class="annottext">res :: [TxOut]
</span><a href="#local-6989586621679560453"><span class="hs-identifier hs-var hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(OutConstraint -&gt; TxOut) -&gt; [OutConstraint] -&gt; [TxOut]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">OutConstraint -&gt; TxOut
</span><a href="Cooked.Tx.Constraints.html#outConstraintToTxOut"><span class="hs-identifier hs-var">outConstraintToTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">[OutConstraint]
</span><a href="#local-6989586621679560455"><span class="hs-identifier hs-var">expected</span></a></span><span>
</span><span id="line-177"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="hs-comment">-- TODO: this should just be `res ++ (given List.\\ res)`. However, there is a bug</span><span>
</span><span id="line-178"></span><span>      </span><span class="hs-comment">-- in plutus-apps where the StakingCredential is erased. Thus, we need to do this</span><span>
</span><span id="line-179"></span><span>      </span><span class="hs-comment">-- custom subtraction.</span><span>
</span><span id="line-180"></span><span>      </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621679560453"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut] -&gt; [TxOut] -&gt; [TxOut]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; TxOut -&gt; Bool) -&gt; [TxOut] -&gt; [TxOut] -&gt; [TxOut]
forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.deleteFirstsBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Credential -&gt; Credential -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span> </span><span class="annot"><span class="annottext">(Credential -&gt; Credential -&gt; Bool)
-&gt; (TxOut -&gt; Credential) -&gt; TxOut -&gt; TxOut -&gt; Bool
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">Address -&gt; Credential
</span><span class="hs-identifier hs-var hs-var">Pl.addressCredential</span></span><span> </span><span class="annot"><span class="annottext">(Address -&gt; Credential)
-&gt; (TxOut -&gt; Address) -&gt; TxOut -&gt; Credential
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TxOut -&gt; Address
</span><span class="hs-identifier hs-var hs-var">Pl.txOutAddress</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621679560454"><span class="hs-identifier hs-var">given</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621679560453"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span class="hs-comment">-- | @signedByWallets ws == SignedBy $ map walletPKHash ws@</span><span>
</span><span id="line-183"></span><span class="annot"><a href="Cooked.Tx.Constraints.html#signedByWallets"><span class="hs-identifier hs-type">signedByWallets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cooked.MockChain.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.Tx.Constraints.Type.html#MiscConstraint"><span class="hs-identifier hs-type">MiscConstraint</span></a></span><span>
</span><span id="line-184"></span><span id="signedByWallets"><span class="annot"><span class="annottext">signedByWallets :: [Wallet] -&gt; MiscConstraint
</span><a href="Cooked.Tx.Constraints.html#signedByWallets"><span class="hs-identifier hs-var hs-var">signedByWallets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PubKeyHash] -&gt; MiscConstraint
</span><a href="Cooked.Tx.Constraints.Type.html#SignedBy"><span class="hs-identifier hs-var">SignedBy</span></a></span><span> </span><span class="annot"><span class="annottext">([PubKeyHash] -&gt; MiscConstraint)
-&gt; ([Wallet] -&gt; [PubKeyHash]) -&gt; [Wallet] -&gt; MiscConstraint
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Wallet -&gt; PubKeyHash) -&gt; [Wallet] -&gt; [PubKeyHash]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Wallet -&gt; PubKeyHash
</span><a href="Cooked.MockChain.Wallet.html#walletPKHash"><span class="hs-identifier hs-var">walletPKHash</span></a></span><span>
</span><span id="line-185"></span></pre></body></html>